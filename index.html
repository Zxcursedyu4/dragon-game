<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #1a1a2e;
            --card-bg: #16213e;
            --accent: #e94560;
            --text: #ffffff;
            --gold: #ffd700;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 15px;
            margin: 0;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .tab.active {
            background: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dragon-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .battle-log {
            background: #00000030;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            height: 150px;
            overflow-y: auto;
        }

        .dice-result {
            color: var(--gold);
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêâ Dragon Empire</h1>
            <div class="resources">
                üí∞ <span id="gold">0</span> | üçó <span id="food">0</span>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('dragons')">–î—Ä–∞–∫–æ–Ω—ã</div>
            <div class="tab" onclick="switchTab('cases')">–ö–µ–π—Å—ã</div>
            <div class="tab" onclick="switchTab('battle')">–î—É—ç–ª–∏</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –î—Ä–∞–∫–æ–Ω—ã -->
        <div id="dragons-tab" class="tab-content active">
            <div id="dragons" class="dragon-list"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö–µ–π—Å—ã -->
        <div id="cases-tab" class="tab-content">
            <div class="cases">
                <div class="case-card">
                    <h3>–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å</h3>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 100üí∞</p>
                    <button class="button" onclick="game.openCase('basic')">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
                <div class="case-card">
                    <h3>–†–µ–¥–∫–∏–π –∫–µ–π—Å</h3>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 500üí∞</p>
                    <button class="button" onclick="game.openCase('rare')">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –î—É—ç–ª–∏ -->
        <div id="battle-tab" class="tab-content">
            <div id="battle-arena">
                <div id="battle-log" class="battle-log"></div>
                <button class="button" onclick="game.startBattle()">–ù–∞—á–∞—Ç—å –±–æ–π</button>
            </div>
        </div>
    </div>

    <script>
        class DragonGame {
            constructor() {
                this.state = {
                    gold: 1000,
                    food: 50,
                    dragons: [],
                    battleLog: [],
                    currentBattle: null,
                    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                };
                
                this.init();
            }

            init() {
                this.load();
                this.render();
                Telegram.WebApp.ready();
            }

            // –°–∏—Å—Ç–µ–º–∞ –±–æ—è –≤ —Å—Ç–∏–ª–µ D&D
            startBattle() {
                const playerDragon = this.state.dragons[0];
                const enemy = this.generateEnemy();
                
                this.state.currentBattle = {
                    round: 1,
                    player: playerDragon,
                    enemy: enemy,
                    log: []
                };

                this.battleLoop();
            }

            battleLoop() {
                const { player, enemy } = this.state.currentBattle;
                
                // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
                const playerAttack = this.rollD20() + player.stats.attack;
                const enemyDefense = 10 + enemy.stats.defense;
                
                if(playerAttack > enemyDefense) {
                    const damage = this.rollDice(8) + player.stats.attack;
                    enemy.stats.hp -= damage;
                    this.logAction(`–ò–≥—Ä–æ–∫ –ø–æ–ø–∞–¥–∞–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞!`);
                } else {
                    this.logAction("–ò–≥—Ä–æ–∫ –ø—Ä–æ–º–∞—Ö–∏–≤–∞–µ—Ç—Å—è!");
                }

                // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
                if(enemy.stats.hp > 0) {
                    const enemyAttack = this.rollD20() + enemy.stats.attack;
                    const playerDefense = 10 + player.stats.defense;
                    
                    if(enemyAttack > playerDefense) {
                        const damage = this.rollDice(8) + enemy.stats.attack;
                        player.stats.hp -= damage;
                        this.logAction(`–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞!`);
                    } else {
                        this.logAction("–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ –ø—Ä–æ–º–∞—Ö–∏–≤–∞–µ—Ç—Å—è!");
                    }
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ –±–æ—è
                if(player.stats.hp <= 0 || enemy.stats.hp <= 0) {
                    this.endBattle();
                } else {
                    this.state.currentBattle.round++;
                    setTimeout(() => this.battleLoop(), 1000);
                }
            }

            rollD20() {
                return Math.floor(Math.random() * 20) + 1;
            }

            rollDice(sides) {
                return Math.floor(Math.random() * sides) + 1;
            }

            logAction(text) {
                this.state.battleLog.push(text);
                this.renderBattleLog();
            }

            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        const game = new DragonGame();
    </script>
</body>
</html>