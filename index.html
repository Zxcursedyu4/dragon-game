<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <style>
        /* –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .hp-flash {
            animation: hpPulse 0.5s ease-in-out;
        }

        @keyframes hpPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .heal-effect {
            position: absolute;
            background: rgba(76, 175, 80, 0.3);
            border-radius: 50%;
            pointer-events: none;
            animation: healPulse 0.8s ease-out;
        }

        @keyframes healPulse {
            0% { 
                transform: scale(0.5);
                opacity: 1;
            }
            100% { 
                transform: scale(2);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- –í—Å—è HTML-—Ä–∞–∑–º–µ—Ç–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->

    <script>
        // –ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–´–ô –ö–û–î –°–ö–†–ò–ü–¢–ê
        let dragon = {
            name: '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π',
            xp: 0,
            stage: 0,
            hp: 100,
            maxHp: 100,
            attack: 10,
            lastFeed: 0,
            healTime: 0,
            inCombat: false
        };

        let currentEnemy = null;
        const stages = [
            {xp: 0, icon: 'ü•ö', name: '–Ø–π—Ü–æ', mult: 1},
            {xp: 1000, icon: 'ü¶é', name: '–ú–∞–ª—ã—à', mult: 10},
            {xp: 10000, icon: 'üê≤', name: '–í–∑—Ä–æ—Å–ª—ã–π', mult: 50},
            {xp: 50000, icon: 'üêâ', name: '–î—Ä–µ–≤–Ω–∏–π', mult: 100},
            {xp: 100000, icon: 'üî•', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', mult: 500}
        ];

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø HP
        function updateHP(newValue) {
            const prevHP = dragon.hp;
            dragon.hp = Math.max(0, Math.min(dragon.maxHp, newValue));
            
            if(dragon.hp <= 0 && prevHP > 0) {
                dragon.healTime = Date.now() + 7200000;
                showDeathTimer();
                addLog('–ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞.');
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏–∏
            if(dragon.hp > prevHP) {
                createHealEffect();
                document.getElementById('hpBar').classList.add('hp-flash');
            }
            
            updateUI();
            localStorage.setItem('dragon', JSON.stringify(dragon));
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –≠–§–§–ï–ö–¢–ê –õ–ï–ß–ï–ù–ò–Ø
        function createHealEffect() {
            const effect = document.createElement('div');
            effect.className = 'heal-effect';
            effect.style.left = `${Math.random() * 80 + 10}%`;
            effect.style.top = `${Math.random() * 80 + 10}%`;
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 800);
        }

        // –ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ê–¢–ê–ö–ò
        function playerAttack() {
            if(!currentEnemy || dragon.healTime > 0) return;
            
            // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
            const stageMult = stages[dragon.stage].mult;
            const dmg = Math.floor(Math.random() * 10 * stageMult) + 1;
            currentEnemy.hp -= dmg;
            addLog(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${dmg} —É—Ä–æ–Ω–∞!`);
            
            // –ê—Ç–∞–∫–∞ –≤—Ä–∞–≥–∞
            const enemyDmg = Math.floor(Math.random() * currentEnemy.attack) + 1;
            updateHP(dragon.hp - enemyDmg); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é
            
            document.getElementById('fightEnemyHP').textContent = Math.max(0, currentEnemy.hp);
            
            if(currentEnemy.hp <= 0) {
                const xpGain = Math.floor(currentEnemy.maxHp * (1 + dragon.stage/2));
                dragon.xp += xpGain;
                addLog(`–ü–æ–±–µ–¥–∞! +${xpGain} –æ–ø—ã—Ç–∞!`);
                currentEnemy = null;
                checkEvolution();
                nextScreen('main');
            }
        }

        // –ú–û–î–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –¢–ê–ô–ú–ï–†–ê –°–ú–ï–†–¢–ò
        function showDeathTimer() {
            const overlay = document.getElementById('deathOverlay');
            overlay.style.display = 'flex';
            document.querySelectorAll('button').forEach(btn => btn.disabled = true);
            
            const updateTimer = () => {
                const remaining = dragon.healTime - Date.now();
                if(remaining <= 0) {
                    overlay.style.display = 'none';
                    dragon.hp = dragon.maxHp;
                    dragon.healTime = 0;
                    document.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    updateUI();
                    return;
                }
                
                const hours = Math.floor(remaining / 3600000);
                const minutes = Math.floor((remaining % 3600000) / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('deathTimer').textContent = 
                    `${hours.toString().padStart(2, '0')}:` +
                    `${minutes.toString().padStart(2, '0')}:` +
                    `${seconds.toString().padStart(2, '0')}`;
                
                requestAnimationFrame(updateTimer);
            };
            
            updateTimer();
        }

        // –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–î –û–°–¢–ê–ï–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô
        // ... (updateUI, feed, checkEvolution, startBattle, addLog, setInterval, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
    </script>
</body>
</html>