<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Evolution</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(45deg, #000000, #4B0082);
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            touch-action: manipulation;
        }

        .screen {
            display: none;
            padding: 20px;
            text-align: center;
            height: 100vh;
            box-sizing: border-box;
            position: relative;
        }

        .active {
            display: flex;
            flex-direction: column;
        }

        .dragon-icon {
            font-size: 30vh;
            margin: auto;
            transition: transform 0.3s;
        }

        .stats {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 10px;
            z-index: 2;
        }

        .stat-item {
            text-align: center;
            padding: 0 10px;
        }

        .progress-bar {
            width: 150px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #8A2BE2;
            transition: width 0.3s;
        }

        .battle-log {
            height: 50vh;
            overflow-y: auto;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            margin: 10px 0;
            border-radius: 10px;
            text-align: left;
            flex-grow: 1;
        }

        button {
            background: #8A2BE2;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            margin: 5px;
            width: 90%;
            transition: opacity 0.3s;
        }

        button:disabled {
            opacity: 0.5;
            background: #444;
        }

        .combat-hp {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            position: absolute;
            top: 70px;
            left: 0;
            right: 0;
        }

        .death-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .death-timer {
            font-size: 24px;
            text-align: center;
            padding: 20px;
            background: #4B0082;
            border-radius: 10px;
        }

        .feed-timer {
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="screen active" id="welcome">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
        <button onclick="nextScreen('name')">–ù–∞—á–∞—Ç—å</button>
    </div>

    <!-- –í—ã–±–æ—Ä –∏–º–µ–Ω–∏ -->
    <div class="screen" id="name">
        <div class="dragon-icon">ü•ö</div>
        <input type="text" placeholder="–ò–º—è –¥—Ä–∞–∫–æ–Ω–∞" id="dragonName">
        <button onclick="setName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω -->
    <div class="screen" id="main">
        <div class="stats">
            <div class="stat-item">
                <div>HP: <span id="currentHP">100</span>/<span id="maxHP">100</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="hpBar"></div>
                </div>
            </div>
            <div class="stat-item">
                <div>XP: <span id="currentXP">0</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="xpBar"></div>
                </div>
            </div>
        </div>
        <div class="dragon-icon" id="dragonIcon">ü•ö</div>
        <div class="buttons">
            <button id="feedBtn" onclick="feed()">–ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
            <button onclick="nextScreen('battle')">–°—Ä–∞–∂–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <!-- –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
    <div class="screen" id="battle">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:</h2>
        <button onclick="startBattle(1)">–õ—ë–≥–∫–∏–π</button>
        <button onclick="startBattle(2)">–°—Ä–µ–¥–Ω–∏–π</button>
        <button onclick="startBattle(3)">–°–ª–æ–∂–Ω—ã–π</button>
        <button onclick="nextScreen('main')">–ù–∞–∑–∞–¥</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –±–æ—è -->
    <div class="screen" id="fight">
        <div class="combat-hp">
            <div class="hp-container">
                –í–∞—à HP: <span id="fightPlayerHP">100</span>
            </div>
            <div class="hp-container">
                –í—Ä–∞–≥ HP: <span id="fightEnemyHP">0</span>
            </div>
        </div>
        <div class="battle-log" id="battleLog"></div>
        <div class="buttons">
            <button onclick="playerAttack()">–ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
            <button onclick="nextScreen('main')">–°–±–µ–∂–∞—Ç—å</button>
        </div>
    </div>

    <!-- –û–≤–µ—Ä–ª–µ–π —Å–º–µ—Ä—Ç–∏ -->
    <div class="death-overlay" id="deathOverlay">
        <div class="death-timer">
            –í–∞—à –¥—Ä–∞–∫–æ–Ω –ø–æ–≤–µ—Ä–∂–µ–Ω!<br>
            –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑:<br>
            <span id="deathTimer">02:00:00</span>
        </div>
    </div>

    <script>
        let dragon = {
            name: '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π',
            xp: 0,
            stage: 0,
            hp: 100,
            maxHp: 100,
            attack: 10,
            lastFeed: 0,
            healTime: 0,
            inCombat: false
        };

        let currentEnemy = null;
        const stages = [
            {xp: 0, icon: 'ü•ö', name: '–Ø–π—Ü–æ', mult: 1},
            {xp: 1000, icon: 'ü¶é', name: '–ú–∞–ª—ã—à', mult: 10},
            {xp: 10000, icon: 'üê≤', name: '–í–∑—Ä–æ—Å–ª—ã–π', mult: 50},
            {xp: 50000, icon: 'üêâ', name: '–î—Ä–µ–≤–Ω–∏–π', mult: 100},
            {xp: 100000, icon: 'üî•', name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π', mult: 500}
        ];

        function updateUI() {
            const stage = stages.find(s => dragon.xp >= s.xp) || stages[0];
            dragon.stage = stages.indexOf(stage);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏
            document.getElementById('dragonIcon').textContent = stage.icon;
            
            // XP
            document.getElementById('currentXP').textContent = dragon.xp;
            const nextStage = stages[dragon.stage + 1] || {xp: Infinity};
            const xpPercent = (dragon.xp - stage.xp) / (nextStage.xp - stage.xp) * 100;
            document.getElementById('xpBar').style.width = `${xpPercent}%`;
            
            // HP
            document.getElementById('currentHP').textContent = Math.floor(dragon.hp);
            document.getElementById('maxHP').textContent = dragon.maxHp;
            document.getElementById('hpBar').style.width = `${(dragon.hp / dragon.maxHp) * 100}%`;
            
            // –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–º–ª–µ–Ω–∏—è
            const feedCooldown = Date.now() - dragon.lastFeed;
            const remaining = 3600000 - feedCooldown;
            const isFeedDisabled = remaining > 0 || dragon.healTime > 0;
            
            document.getElementById('feedBtn').disabled = isFeedDisabled;
            
            let timerText = '';
            if(remaining > 0) {
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                timerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            document.getElementById('feedBtn').innerHTML = `
                –ü–æ–∫–æ—Ä–º–∏—Ç—å
                ${remaining > 0 ? `<div class="feed-timer">${timerText}</div>` : ''}
            `;
        }

        function feed() {
            if(Date.now() - dragon.lastFeed < 3600000) return;
            
            dragon.lastFeed = Date.now();
            const stage = stages[dragon.stage];
            const xpGain = Math.floor((Math.random() * 10 + 1) * stage.mult);
            dragon.xp += xpGain;
            
            addLog(`–ü–æ–ª—É—á–µ–Ω–æ ${xpGain} –æ–ø—ã—Ç–∞!`);
            updateUI();
            checkEvolution();
            localStorage.setItem('dragon', JSON.stringify(dragon));
        }

        function checkEvolution() {
            const newStage = stages.find(s => dragon.xp >= s.xp && s.xp > stages[dragon.stage].xp);
            if(newStage) {
                dragon.maxHp = 100 * newStage.mult;
                dragon.hp = dragon.maxHp;
                addLog(`üéâ –≠–≤–æ–ª—é—Ü–∏—è! –¢–µ–ø–µ—Ä—å –≤—ã ${newStage.name}!`);
                updateUI();
            }
        }

        function startBattle(difficulty) {
            if(dragon.healTime > 0) return;
            
            const baseHP = [50, 150, 300][difficulty-1];
            currentEnemy = {
                name: ['–ì–æ–±–ª–∏–Ω', '–û—Ä–∫', '–î—Ä–∞–∫–æ–Ω'][difficulty-1],
                hp: baseHP,
                maxHp: baseHP,
                attack: [10, 25, 50][difficulty-1]
            };
            
            document.getElementById('fightEnemyHP').textContent = currentEnemy.hp;
            document.getElementById('fightPlayerHP').textContent = Math.floor(dragon.hp);
            dragon.inCombat = true;
            nextScreen('fight');
            addLog(`–ë–æ–π —Å ${currentEnemy.name} –Ω–∞—á–∞–ª—Å—è!`);
        }

        function playerAttack() {
            if(!currentEnemy || dragon.healTime > 0) return;
            
            // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
            const stageMult = stages[dragon.stage].mult;
            const dmg = Math.floor(Math.random() * 10 * stageMult) + 1;
            currentEnemy.hp -= dmg;
            addLog(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${dmg} —É—Ä–æ–Ω–∞!`);
            
            // –ê—Ç–∞–∫–∞ –≤—Ä–∞–≥–∞
            const enemyDmg = Math.floor(Math.random() * currentEnemy.attack) + 1;
            dragon.hp -= enemyDmg;
            addLog(`${currentEnemy.name} –Ω–∞–Ω–æ—Å–∏—Ç ${enemyDmg} —É—Ä–æ–Ω–∞!`);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP
            document.getElementById('fightEnemyHP').textContent = Math.max(0, currentEnemy.hp);
            document.getElementById('fightPlayerHP').textContent = Math.floor(dragon.hp);
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ü–∞ –±–æ—è
            if(currentEnemy.hp <= 0) {
                const xpGain = Math.floor(currentEnemy.maxHp * (1 + dragon.stage/2));
                dragon.xp += xpGain;
                addLog(`–ü–æ–±–µ–¥–∞! +${xpGain} –æ–ø—ã—Ç–∞!`);
                currentEnemy = null;
                dragon.inCombat = false;
                checkEvolution();
                nextScreen('main');
            }
            
            if(dragon.hp <= 0) {
                dragon.healTime = Date.now() + 7200000; // 2 —á–∞—Å–∞
                dragon.inCombat = false;
                currentEnemy = null;
                showDeathTimer();
                addLog('–ü–æ—Ä–∞–∂–µ–Ω–∏–µ! –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞.');
            }
            
            localStorage.setItem('dragon', JSON.stringify(dragon));
        }

        function showDeathTimer() {
            const overlay = document.getElementById('deathOverlay');
            overlay.style.display = 'flex';
            
            const updateTimer = () => {
                const remaining = dragon.healTime - Date.now();
                if(remaining <= 0) {
                    overlay.style.display = 'none';
                    dragon.hp = dragon.maxHp;
                    dragon.healTime = 0;
                    updateUI();
                    return;
                }
                
                const hours = Math.floor(remaining / 3600000);
                const minutes = Math.floor((remaining % 3600000) / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('deathTimer').textContent = `
                    ${hours.toString().padStart(2, '0')}:
                    ${minutes.toString().padStart(2, '0')}:
                    ${seconds.toString().padStart(2, '0')}
                `;
                requestAnimationFrame(updateTimer);
            };
            
            updateTimer();
        }

        function addLog(message) {
            const log = document.getElementById('battleLog');
            log.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è HP
        setInterval(() => {
            if(!dragon.inCombat && dragon.hp < dragon.maxHp && dragon.healTime === 0) {
                dragon.hp = Math.min(dragon.hp + 1, dragon.maxHp);
                updateUI();
            }
        }, 300);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            if(localStorage.getItem('dragon')) {
                dragon = JSON.parse(localStorage.getItem('dragon'));
                if(dragon.healTime > 0 && Date.now() > dragon.healTime) {
                    dragon.healTime = 0;
                    dragon.hp = dragon.maxHp;
                }
                updateUI();
                nextScreen('main');
            }
        };

        function nextScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function setName() {
            dragon.name = document.getElementById('dragonName').value || '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π';
            localStorage.setItem('dragon', JSON.stringify(dragon));
            nextScreen('main');
        }
    </script>
</body>
</html>