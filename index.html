<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Evolution</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(45deg, #000000, #4B0082);
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            touch-action: manipulation;
        }

        .screen {
            display: none;
            padding: 20px;
            text-align: center;
        }

        .active {
            display: block;
        }

        .dragon-icon {
            font-size: 100px;
            margin: 20px 0;
            transition: transform 0.3s;
        }

        .stats {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 10px;
        }

        .progress-bar {
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 5px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #8A2BE2;
            transition: width 0.3s;
        }

        .battle-log {
            height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            margin: 10px 0;
            border-radius: 10px;
            text-align: left;
        }

        button {
            background: #8A2BE2;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            margin: 5px;
            width: 90%;
        }

        button:disabled {
            background: #444;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="screen active" id="welcome">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
        <p>–ö–æ–º–∞–Ω–¥–∞ @Dragon1EggBot –∂–µ–ª–∞–µ—Ç –≤–∞–º –ø—Ä–∏—è—Ç–Ω–æ–π –∏–≥—Ä—ã!</p>
        <button onclick="nextScreen('name')">–ù–∞—á–∞—Ç—å</button>
    </div>

    <!-- –í—ã–±–æ—Ä –∏–º–µ–Ω–∏ -->
    <div class="screen" id="name">
        <div class="dragon-icon">ü•ö</div>
        <input type="text" placeholder="–ò–º—è –¥—Ä–∞–∫–æ–Ω–∞" id="dragonName">
        <button onclick="setName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω -->
    <div class="screen" id="main">
        <div class="stats">
            <div>HP: <span id="currentHP">100</span>/<span id="maxHP">100</span></div>
            <div class="progress-bar" onclick="showNextEvolution()">
                <div class="progress-fill" id="xpBar"></div>
            </div>
        </div>
        <div class="dragon-icon" id="dragonIcon">ü•ö</div>
        <div class="buttons">
            <button id="feedBtn" onclick="feed()">–ü–æ–∫–æ—Ä–º–∏—Ç—å (4—á)</button>
            <button onclick="nextScreen('battle')">–°—Ä–∞–∂–∞—Ç—å—Å—è</button>
        </div>
    </div>

    <!-- –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
    <div class="screen" id="battle">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:</h2>
        <button onclick="startBattle(1)">–õ—ë–≥–∫–∏–π</button>
        <button onclick="startBattle(2)">–°—Ä–µ–¥–Ω–∏–π</button>
        <button onclick="startBattle(3)">–°–ª–æ–∂–Ω—ã–π</button>
        <button onclick="nextScreen('main')">–ù–∞–∑–∞–¥</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –±–æ—è -->
    <div class="screen" id="fight">
        <div class="battle-log" id="battleLog"></div>
        <div class="buttons">
            <button onclick="playerAttack()">–ê—Ç–∞–∫–æ–≤–∞—Ç—å</button>
            <button onclick="nextScreen('main')">–°–±–µ–∂–∞—Ç—å</button>
        </div>
    </div>

    <script>
        let dragon = {
            name: '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π',
            xp: 0,
            stage: 0,
            hp: 100,
            maxHp: 100,
            attack: 10,
            lastFeed: 0,
            healTime: 0
        };

        let currentEnemy = null;
        const stages = [
            {xp: 0, icon: 'ü•ö', name: '–Ø–π—Ü–æ', attack: 5, hp: 50},
            {xp: 1000, icon: 'ü¶é', name: '–ú–∞–ª—ã—à', attack: 15, hp: 150},
            {xp: 10000, icon: 'üê≤', name: '–í–∑—Ä–æ—Å–ª—ã–π', attack: 30, hp: 300},
            {xp: 50000, icon: 'üêâ', name: '–î—Ä–µ–≤–Ω–∏–π', attack: 50, hp: 500}
        ];

        function updateUI() {
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏ –∏ —Å—Ç–∞–¥–∏–∏
            const stage = stages.find(s => dragon.xp >= s.xp) || stages[0];
            dragon.stage = stages.indexOf(stage);
            document.getElementById('dragonIcon').textContent = stage.icon;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä
            const nextStage = stages[dragon.stage + 1] || {xp: Infinity};
            const xpPercent = (dragon.xp - stage.xp) / (nextStage.xp - stage.xp) * 100;
            document.getElementById('xpBar').style.width = `${xpPercent}%`;
            
            // HP
            document.getElementById('currentHP').textContent = dragon.hp;
            document.getElementById('maxHP').textContent = dragon.maxHp;
            
            // –ö–Ω–æ–ø–∫–∞ –∫–æ—Ä–º–ª–µ–Ω–∏—è
            const feedCooldown = Date.now() - dragon.lastFeed;
            document.getElementById('feedBtn').disabled = feedCooldown < 14400000;
            document.getElementById('feedBtn').innerHTML = 
                feedCooldown < 14400000 ? 
                `–ü–æ–∫–æ—Ä–º–∏—Ç—å (${Math.ceil((14400000 - feedCooldown)/3600000)}—á)` : 
                '–ü–æ–∫–æ—Ä–º–∏—Ç—å';
        }

        function feed() {
            if(Date.now() - dragon.lastFeed < 14400000) return;
            
            let xpGain = Math.floor(Math.random() * 10 * (dragon.stage + 1));
            dragon.xp += xpGain;
            dragon.lastFeed = Date.now();
            addLog(`–ü–æ–ª—É—á–µ–Ω–æ ${xpGain} –æ–ø—ã—Ç–∞!`);
            updateUI();
            checkEvolution();
            localStorage.setItem('dragon', JSON.stringify(dragon));
        }

        function checkEvolution() {
            const newStage = stages.find(s => dragon.xp >= s.xp && s.xp > stages[dragon.stage].xp);
            if(newStage) {
                dragon.maxHp = newStage.hp;
                dragon.hp = newStage.hp;
                dragon.attack = newStage.attack;
                addLog(`üéâ –î—Ä–∞–∫–æ–Ω —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–ª –≤ ${newStage.name}!`);
            }
        }

        function startBattle(difficulty) {
            const enemies = [
                {name: '–ì–æ–±–ª–∏–Ω', hp: 20, attack: 5},
                {name: '–û—Ä–∫', hp: 50, attack: 15},
                {name: '–î—Ä–∞–∫–æ–Ω', hp: 100, attack: 30}
            ];
            
            currentEnemy = {
                ...enemies[difficulty-1],
                maxHp: enemies[difficulty-1].hp
            };
            
            nextScreen('fight');
            addLog(`–ë–æ–π –Ω–∞—á–∞–ª—Å—è! –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: ${currentEnemy.name}`);
        }

        function playerAttack() {
            if(!currentEnemy) return;
            
            // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
            const dmg = Math.floor(Math.random() * dragon.attack) + 1;
            currentEnemy.hp -= dmg;
            addLog(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${dmg} —É—Ä–æ–Ω–∞!`);
            
            if(currentEnemy.hp <= 0) {
                const xpGain = Math.floor(Math.random() * 20 * (currentEnemy.maxHp/10));
                dragon.xp += xpGain;
                addLog(`–ü–æ–±–µ–¥–∞! –ü–æ–ª—É—á–µ–Ω–æ ${xpGain} –æ–ø—ã—Ç–∞!`);
                currentEnemy = null;
                updateUI();
                return;
            }
            
            // –ê—Ç–∞–∫–∞ –≤—Ä–∞–≥–∞
            const enemyDmg = Math.floor(Math.random() * currentEnemy.attack) + 1;
            dragon.hp -= enemyDmg;
            addLog(`${currentEnemy.name} –Ω–∞–Ω–æ—Å–∏—Ç ${enemyDmg} —É—Ä–æ–Ω–∞!`);
            
            if(dragon.hp <= 0) {
                dragon.healTime = Date.now() + 43200000;
                addLog('–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏! –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 12 —á–∞—Å–æ–≤.');
                currentEnemy = null;
            }
            
            updateUI();
        }

        function addLog(message) {
            const log = document.getElementById('battleLog');
            log.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        // –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
        setInterval(() => {
            if(dragon.hp < dragon.maxHp) dragon.hp++;
            if(dragon.healTime > 0 && Date.now() > dragon.healTime) {
                dragon.hp = dragon.maxHp;
                dragon.healTime = 0;
            }
            updateUI();
        }, 300);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            if(localStorage.getItem('dragon')) {
                dragon = JSON.parse(localStorage.getItem('dragon'));
                updateUI();
                nextScreen('main');
            }
        };

        function nextScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function setName() {
            dragon.name = document.getElementById('dragonName').value || '–ë–µ–∑—ã–º—è–Ω–Ω—ã–π';
            localStorage.setItem('dragon', JSON.stringify(dragon));
            nextScreen('main');
        }

        function showNextEvolution() {
            const nextStage = stages[dragon.stage + 1];
            if(nextStage) {
                alert(`–î–æ —Å–ª–µ–¥—É—é—â–µ–π —ç–≤–æ–ª—é—Ü–∏–∏: ${nextStage.xp - dragon.xp} –æ–ø—ã—Ç–∞`);
            } else {
                alert('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç!');
            }
        }
    </script>
</body>
</html>