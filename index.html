<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #1a1a2e;
            --card-bg: #16213e;
            --accent: #e94560;
            --text: #ffffff;
            --gold: #ffd700;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 15px;
            margin: 0;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .dragon-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .dragon-emoji {
            font-size: 3em;
            text-align: center;
            margin: 10px 0;
        }

        .progress-bar {
            height: 8px;
            background: #30475e;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.5s;
        }

        .button {
            background: var(--accent);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .timer {
            font-size: 0.9em;
            color: #8f8f8f;
            margin-top: 5px;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêâ Dragon Empire</h1>
            <div class="resources">
                üí∞ <span id="gold">0</span> | üçó <span id="food">0</span>
            </div>
        </div>

        <div id="dragons" class="dragon-list"></div>
        
        <div class="actions">
            <button class="button" onclick="game.openCase('basic')">–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å (100üí∞)</button>
            <button class="button" onclick="game.spinRoulette()">–†—É–ª–µ—Ç–∫–∞ (4—á)</button>
        </div>
    </div>

    <script>
        class DragonGame {
            constructor() {
                this.state = {
                    gold: 1000,
                    food: 50,
                    dragons: [],
                    lastActions: {},
                    cases: {
                        basic: { cost: 100, rewards: ['food', 'gold', 'dragon-C'] },
                        rare: { cost: 500, rewards: ['dragon-B', 'gold-500', 'food-100'] },
                        epic: { cost: 2000, rewards: ['dragon-A', 'dragon-S', 'gold-2000'] }
                    },
                    dragonTypes: {
                        'C': { emoji: 'üê≤', stats: { hp: 100, attack: 10, speed: 5 }, evolve: null },
                        'B': { emoji: 'üêâ', stats: { hp: 150, attack: 15, speed: 7 }, evolve: null },
                        'A': { emoji: 'üî•', stats: { hp: 200, attack: 20, speed: 10 }, evolve: 'S' },
                        'S': { emoji: 'ü¶ñ', stats: { hp: 300, attack: 30, speed: 15 }, evolve: 'SS' },
                        'SS': { emoji: 'üêä', stats: { hp: 500, attack: 50, speed: 20 }, evolve: 'SSS' },
                        'SSS': { emoji: '‚ú®', stats: { hp: 1000, attack: 100, speed: 30 }, evolve: 'Ancient' }
                    }
                };
                
                this.init();
            }

            init() {
                this.load();
                this.render();
                setInterval(() => this.updateTimers(), 1000);
                Telegram.WebApp.ready();
                Telegram.WebApp.MainButton.setText('–ú–µ–Ω—é').show().onClick(() => this.showMenu());
            }

            render() {
                document.getElementById('gold').textContent = this.state.gold;
                document.getElementById('food').textContent = this.state.food;
                this.renderDragons();
            }

            renderDragons() {
                const container = document.getElementById('dragons');
                container.innerHTML = '';
                
                this.state.dragons.forEach(dragon => {
                    const dragonElement = document.createElement('div');
                    dragonElement.className = 'dragon-card';
                    dragonElement.innerHTML = `
                        <div class="dragon-emoji">${dragon.emoji}</div>
                        <div>–£—Ä–æ–≤–µ–Ω—å: ${dragon.level}</div>
                        <div>–†–µ–¥–∫–æ—Å—Ç—å: ${dragon.rarity}</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${(dragon.xp / dragon.xpToNextLevel) * 100}%"></div>
                        </div>
                        <button class="button" onclick="game.trainDragon('${dragon.id}')" 
                            ${dragon.training ? 'disabled' : ''}>
                            –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å (2—á)
                        </button>
                        <button class="button" onclick="game.sendExpedition('${dragon.id}')" 
                            ${dragon.expedition ? 'disabled' : ''}>
                            –í—ã–ª–∞–∑–∫–∞ (2—á)
                        </button>
                        ${dragon.training ? `<div class="timer">–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞: ${this.formatTime(dragon.training.end - Date.now())}</div>` : ''}
                    `;
                    container.appendChild(dragonElement);
                });
            }

            createDragon(rarity) {
                const type = this.state.dragonTypes[rarity];
                return {
                    id: Date.now().toString(),
                    emoji: type.emoji,
                    rarity: rarity,
                    level: 1,
                    xp: 0,
                    xpToNextLevel: 100,
                    stats: { ...type.stats },
                    training: null,
                    expedition: null
                };
            }

            openCase(type) {
                const caseInfo = this.state.cases[type];
                if (this.state.gold < caseInfo.cost) return;
                
                this.state.gold -= caseInfo.cost;
                const reward = caseInfo.rewards[Math.floor(Math.random() * caseInfo.rewards.length)];
                
                if (reward.startsWith('dragon-')) {
                    const rarity = reward.split('-')[1];
                    this.state.dragons.push(this.createDragon(rarity));
                }
                
                this.render();
            }

            spinRoulette() {
                // –õ–æ–≥–∏–∫–∞ —Ä—É–ª–µ—Ç–∫–∏
            }

            trainDragon(id) {
                const dragon = this.state.dragons.find(d => d.id === id);
                if (!dragon || dragon.training) return;
                
                dragon.training = {
                    start: Date.now(),
                    duration: 7200000 // 2 —á–∞—Å–∞
                };
                this.render();
            }

            sendExpedition(id) {
                const dragon = this.state.dragons.find(d => d.id === id);
                if (!dragon || dragon.expedition) return;
                
                dragon.expedition = {
                    start: Date.now(),
                    duration: 7200000 // 2 —á–∞—Å–∞
                };
                this.render();
            }

            formatTime(ms) {
                const hours = Math.floor(ms / 3600000);
                const minutes = Math.floor((ms % 3600000) / 60000);
                return `${hours}—á ${minutes}–º`;
            }

            updateTimers() {
                this.state.dragons.forEach(dragon => {
                    if (dragon.training && Date.now() > dragon.training.start + dragon.training.duration) {
                        dragon.level++;
                        dragon.training = null;
                    }
                    
                    if (dragon.expedition && Date.now() > dragon.expedition.start + dragon.expedition.duration) {
                        this.state.gold += 100;
                        this.state.food += 50;
                        dragon.expedition = null;
                    }
                });
                this.render();
            }

            load() {
                const saved = localStorage.getItem('dragonGame');
                if (saved) this.state = JSON.parse(saved);
            }

            save() {
                localStorage.setItem('dragonGame', JSON.stringify(this.state));
            }

            showMenu() {
                // –õ–æ–≥–∏–∫–∞ –º–µ–Ω—é
            }
        }

        const game = new DragonGame();
    </script>
</body>
</html>