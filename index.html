<!DOCTYPE html>
<html>
<head>
    <title>Dragon RPG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        :root {
            --bg-color: #0f0f15;
            --card-color: #1a1a25;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --secondary-color: #03dac6;
            --button-bg: #3700b3;
            --button-hover: #6200ee;
            --error-color: #ff4444;
            --success-color: #00C851;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
            line-height: 1.5;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
        .container {
            max-width: 100%;
            padding: 10px;
            padding-bottom: 60px;
            will-change: transform;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 10px;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 5px;
            scrollbar-width: none;
        }
        
        .tab-container::-webkit-scrollbar {
            display: none;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .dragon-pen {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 12px;
            contain: strict;
        }
        
        .dragon-card {
            background: var(--card-color);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
            position: relative;
            overflow: hidden;
            will-change: transform;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .notification {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-color);
            color: #000;
            padding: 8px 16px;
            border-radius: 5px;
            z-index: 100;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            max-width: 90%;
            text-align: center;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        
        /* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –Ω–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .bottom-menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #1a1a25;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.2);
            z-index: 50;
            backdrop-filter: blur(5px);
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 400px) {
            .dragon-pen {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .dragon-emoji {
                font-size: 32px !important;
            }
        }
    </style>
</head>
<body>
    <div class="notification" id="notification"></div>
    
    <div class="container">
        <!-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    </div>

    <div class="bottom-menu">
        <button class="menu-btn active">üêâ</button>
        <button class="menu-btn">‚öîÔ∏è</button>
        <button class="menu-btn">üé∞</button>
        <button class="menu-btn">üéÅ</button>
        <button class="menu-btn">üõí</button>
    </div>

    <script>
        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –∏–≥—Ä—ã
        const Game = {
            state: {
                coins: 100,
                food: 20,
                battlePoints: 0,
                dragons: [],
                lastSpin: null,
                lastCases: {},
                battle: null,
                passiveIncomeInterval: null
            },
            
            consts: {
                dragonTypes: [
                    { emoji: "üê≤", name: "–û–±—ã—á–Ω—ã–π", rank: "C", stats: [80, 10, 5, 8] },
                    { emoji: "üêâ", name: "–†–µ–¥–∫–∏–π", rank: "B", stats: [100, 15, 8, 10] },
                    { emoji: "üî•", name: "–û–≥–Ω–µ–Ω–Ω—ã–π", rank: "A", stats: [120, 20, 10, 12] },
                    { emoji: "ü¶é", name: "–ù–µ–≤–∏–¥–∏–º–∫–∞", rank: "S", stats: [100, 25, 15, 20] },
                    { emoji: "üêä", name: "–ö–æ—Ä–æ–ª—å", rank: "SS", stats: [150, 30, 20, 15] },
                    { emoji: "‚ú®", name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π", rank: "SSS", stats: [200, 40, 25, 18] }
                ],
                caseCooldowns: { common: 4, epic: 12 }
            },
            
            init() {
                this.load();
                this.setupPassiveIncome();
                Telegram.WebApp.ready();
                this.render();
            },
            
            load() {
                const saved = localStorage.getItem('dragonGame');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        this.state = { ...this.state, ...parsed };
                        
                        // –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                        if (this.state.dragons.length && !this.state.dragons[0].skills) {
                            this.state.dragons = this.state.dragons.map(d => ({
                                ...d,
                                skills: this.getDragonType(d.type).skills || ['–£–∫—É—Å'],
                                special: this.getDragonType(d.type).special || { name: "–ê—Ç–∞–∫–∞", power: 10 }
                            }));
                        }
                    } catch (e) {
                        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
                    }
                }
                
                // –°—Ç–∞—Ä—Ç–æ–≤—ã–µ –¥—Ä–∞–∫–æ–Ω—ã
                if (this.state.dragons.length === 0) {
                    this.state.dragons = [
                        this.createDragon("C"),
                        this.createDragon("C")
                    ];
                }
            },
            
            save() {
                try {
                    localStorage.setItem('dragonGame', JSON.stringify({
                        coins: this.state.coins,
                        food: this.state.food,
                        dragons: this.state.dragons,
                        lastSpin: this.state.lastSpin,
                        lastCases: this.state.lastCases
                    }));
                } catch (e) {
                    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                }
            },
            
            createDragon(type) {
                const template = this.getDragonType(type);
                return {
                    id: Date.now().toString(36),
                    type,
                    emoji: template.emoji,
                    name: template.name,
                    level: 1,
                    xp: 0,
                    stats: [...template.stats],
                    skills: template.skills || ['–£–∫—É—Å'],
                    special: template.special || { name: "–ê—Ç–∞–∫–∞", power: 10 },
                    fedToday: 0,
                    battlesWon: 0
                };
            },
            
            getDragonType(rank) {
                return this.consts.dragonTypes.find(t => t.rank === rank) || this.consts.dragonTypes[0];
            },
            
            setupPassiveIncome() {
                if (this.state.passiveIncomeInterval) {
                    clearInterval(this.state.passiveIncomeInterval);
                }
                
                this.state.passiveIncomeInterval = setInterval(() => {
                    this.state.dragons.forEach(d => {
                        this.state.coins += this.getIncomeForDragon(d.type);
                        if (Math.random() < 0.1) this.state.food += 1;
                    });
                    this.save();
                    this.updateUI();
                }, 60000);
            },
            
            getIncomeForDragon(type) {
                const incomeMap = { C: 1, B: 2, A: 4, S: 8, SS: 15, SSS: 30 };
                return incomeMap[type] || 0;
            },
            
            render() {
                // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥
                requestAnimationFrame(() => {
                    this.updateUI();
                    this.setupEventListeners();
                });
            },
            
            updateUI() {
                // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
            },
            
            setupEventListeners() {
                // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
                document.addEventListener('click', (e) => {
                    const btn = e.target.closest('[data-action]');
                    if (!btn) return;
                    
                    const action = btn.dataset.action;
                    if (this[action]) {
                        this[action](btn.dataset);
                    }
                });
            },
            
            // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–≥—Ä—ã
            feedDragon({id}) {
                const dragon = this.state.dragons.find(d => d.id === id);
                if (!dragon || this.state.food <= 0 || dragon.fedToday >= 3) return;
                
                this.state.food--;
                dragon.fedToday++;
                
                const xpGain = this.getXpForFeed(dragon.type);
                dragon.xp += xpGain;
                
                this.checkLevelUp(dragon);
                this.showNotification(`${dragon.name} +${xpGain} XP`);
                this.save();
                this.updateUI();
            },
            
            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã...
            
            showNotification(msg) {
                const el = document.getElementById('notification');
                if (!el) return;
                
                el.textContent = msg;
                el.style.opacity = '1';
                
                clearTimeout(this.notificationTimeout);
                this.notificationTimeout = setTimeout(() => {
                    el.style.opacity = '0';
                }, 3000);
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => Game.init());
    </script>
</body>
</html>
