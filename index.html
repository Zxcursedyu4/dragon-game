<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #1a1a2e;
            --card-bg: #16213e;
            --accent: #e94560;
            --text: #ffffff;
            --gold: #ffd700;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 15px;
            margin: 0;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            background: var(--card-bg);
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .tab.active {
            background: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .dragon-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .battle-log {
            background: #00000030;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            height: 150px;
            overflow-y: auto;
        }

        .dice-result {
            color: var(--gold);
            font-weight: bold;
        }

        .button {
            background: var(--accent);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            margin: 5px;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .combatant {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            background: #ffffff10;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üêâ Dragon Empire</h1>
            <div class="resources">
                üí∞ <span id="gold">1000</span> | üçó <span id="food">50</span>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('dragons')">–î—Ä–∞–∫–æ–Ω—ã</div>
            <div class="tab" onclick="switchTab('cases')">–ö–µ–π—Å—ã</div>
            <div class="tab" onclick="switchTab('battle')">–î—É—ç–ª–∏</div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –î—Ä–∞–∫–æ–Ω—ã -->
        <div id="dragons-tab" class="tab-content active">
            <div id="dragons" class="dragon-list"></div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –ö–µ–π—Å—ã -->
        <div id="cases-tab" class="tab-content">
            <div class="cases">
                <div class="dragon-card">
                    <h3>–ë–∞–∑–æ–≤—ã–π –∫–µ–π—Å</h3>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 100üí∞</p>
                    <button class="button" onclick="game.openCase('basic')">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
                <div class="dragon-card">
                    <h3>–†–µ–¥–∫–∏–π –∫–µ–π—Å</h3>
                    <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 500üí∞</p>
                    <button class="button" onclick="game.openCase('rare')">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞ –î—É—ç–ª–∏ -->
        <div id="battle-tab" class="tab-content">
            <div id="battle-arena">
                <div class="combatant" id="player-combatant">
                    <div>–í–∞—à –¥—Ä–∞–∫–æ–Ω: <span id="player-name"></span></div>
                    <div>HP: <span id="player-hp"></span></div>
                </div>
                <div class="combatant" id="enemy-combatant">
                    <div>–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫: <span id="enemy-name"></span></div>
                    <div>HP: <span id="enemy-hp"></span></div>
                </div>
                <div id="battle-log" class="battle-log"></div>
                <button class="button" id="start-battle" onclick="game.startBattle()">–ù–∞—á–∞—Ç—å –±–æ–π</button>
            </div>
        </div>
    </div>

    <script>
        class DragonGame {
            constructor() {
                this.state = {
                    gold: 1000,
                    food: 50,
                    dragons: [
                        {
                            id: 1,
                            name: "–û–≥–Ω–µ–Ω–Ω—ã–π –¥—Ä–∞–∫–æ–Ω",
                            type: "A",
                            stats: {
                                hp: 200,
                                maxHp: 200,
                                attack: 5,
                                defense: 3,
                                level: 1
                            },
                            emoji: "üî•"
                        }
                    ],
                    currentBattle: null
                };
            }

            openCase(type) {
                const cases = {
                    basic: { cost: 100, dragons: ["C", "B"] },
                    rare: { cost: 500, dragons: ["A", "S"] }
                };
                
                if (this.state.gold < cases[type].cost) return;
                
                this.state.gold -= cases[type].cost;
                const dragonType = cases[type].dragons[Math.floor(Math.random() * cases[type].dragons.length)];
                this.addDragon(dragonType);
                this.updateUI();
            }

            addDragon(type) {
                const dragons = {
                    C: { name: "–û–±—ã—á–Ω—ã–π –¥—Ä–∞–∫–æ–Ω", stats: { hp: 100, maxHp: 100, attack: 2, defense: 1 }, emoji: "üê≤" },
                    B: { name: "–†–µ–¥–∫–∏–π –¥—Ä–∞–∫–æ–Ω", stats: { hp: 150, maxHp: 150, attack: 3, defense: 2 }, emoji: "üêâ" },
                    A: { name: "–≠–ø–∏—á–µ—Å–∫–∏–π –¥—Ä–∞–∫–æ–Ω", stats: { hp: 200, maxHp: 200, attack: 5, defense: 3 }, emoji: "üî•" },
                    S: { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –¥—Ä–∞–∫–æ–Ω", stats: { hp: 300, maxHp: 300, attack: 7, defense: 5 }, emoji: "‚ú®" }
                };

                this.state.dragons.push({
                    id: Date.now(),
                    ...dragons[type],
                    stats: { ...dragons[type].stats },
                    level: 1
                });
            }

            startBattle() {
                if (this.state.dragons.length === 0) return;
                
                this.state.currentBattle = {
                    player: {...this.state.dragons[0].stats},
                    enemy: this.generateEnemy(),
                    log: []
                };

                document.getElementById('start-battle').disabled = true;
                this.updateBattleUI();
                this.battleLoop();
            }

            generateEnemy() {
                const enemies = [
                    { name: "–ì–æ–±–ª–∏–Ω", hp: 30, attack: 4, defense: 2 },
                    { name: "–û—Ä–∫", hp: 50, attack: 6, defense: 3 },
                    { name: "–î—Ä–∞–∫–æ–Ω–∏–¥", hp: 80, attack: 8, defense: 5 }
                ];
                
                return {...enemies[Math.floor(Math.random() * enemies.length)]};
            }

            battleLoop() {
                if (!this.state.currentBattle) return;

                const { player, enemy } = this.state.currentBattle;
                
                // –•–æ–¥ –∏–≥—Ä–æ–∫–∞
                const playerAttackRoll = this.rollD20() + player.attack;
                if (playerAttackRoll > enemy.defense + 10) {
                    const damage = this.rollDice(8) + player.attack;
                    enemy.hp = Math.max(0, enemy.hp - damage);
                    this.logBattle(`–í—ã –∞—Ç–∞–∫—É–µ—Ç–µ –∏ –Ω–∞–Ω–æ—Å–∏—Ç–µ ${damage} —É—Ä–æ–Ω–∞!`);
                } else {
                    this.logBattle("–í—ã –ø—Ä–æ–º–∞—Ö–Ω—É–ª–∏—Å—å!");
                }

                // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
                if (enemy.hp > 0) {
                    const enemyAttackRoll = this.rollD20() + enemy.attack;
                    if (enemyAttackRoll > player.defense + 10) {
                        const damage = this.rollDice(8) + enemy.attack;
                        player.hp = Math.max(0, player.hp - damage);
                        this.logBattle(`${enemy.name} –∞—Ç–∞–∫—É–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞!`);
                    } else {
                        this.logBattle(`${enemy.name} –ø—Ä–æ–º–∞—Ö–Ω—É–ª—Å—è!`);
                    }
                }

                this.updateBattleUI();

                if (player.hp <= 0 || enemy.hp <= 0) {
                    this.endBattle();
                } else {
                    setTimeout(() => this.battleLoop(), 1500);
                }
            }

            endBattle() {
                const result = this.state.currentBattle.player.hp > 0 ? "–ü–æ–±–µ–¥–∞!" : "–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!";
                this.logBattle(`${result} –ë–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω!`);
                document.getElementById('start-battle').disabled = false;
                this.state.currentBattle = null;
            }

            rollD20() {
                return Math.floor(Math.random() * 20) + 1;
            }

            rollDice(sides) {
                return Math.floor(Math.random() * sides) + 1;
            }

            logBattle(message) {
                const log = document.getElementById('battle-log');
                log.innerHTML += `<div class="dice-result">${message}</div>`;
                log.scrollTop = log.scrollHeight;
            }

            updateUI() {
                document.getElementById('gold').textContent = this.state.gold;
                document.getElementById('food').textContent = this.state.food;
            }

            updateBattleUI() {
                if (!this.state.currentBattle) return;

                const { player, enemy } = this.state.currentBattle;
                document.getElementById('player-name').textContent = this.state.dragons[0].name;
                document.getElementById('player-hp').textContent = `${player.hp}/${this.state.dragons[0].stats.maxHp}`;
                document.getElementById('enemy-name').textContent = enemy.name;
                document.getElementById('enemy-hp').textContent = `${enemy.hp}/${enemy.hp + enemy.hp}`;
            }
        }

        const game = new DragonGame();

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Mini App
        Telegram.WebApp.ready();
        Telegram.WebApp.MainButton.setText('–ú–µ–Ω—é').show();
    </script>
</body>
</html>